var prevConfiguration=null;function retrieveUser(e,t,r){if(null==e){if(null==t)return e=1,void postMessage(["user",e]);var o={guid:t,code:r};console.log(o),request("user","../controller/user_retrieve.php",o)}else postMessage(["user",e])}function retrieveConfiguration(e){request("configuration","../controller/configuration_retrieve.php",{user:e})}function retrieveMetronome(e,t,r){request("metronome","../controller/metronome_retrieve.php",{user:e,title:"Sura Time "+t,page:r})}function saveMetronome(e){request("metronome-save","../controller/metronome_save_all.php",{user:e})}function onRequestSuccess(e,t){switch(e){case"user":postMessage(["user",t]);break;case"configuration":t!=prevConfiguration&&(t.length>2?postMessage(["configuration",t]):postMessage(["configuration","empty"]),prevConfiguration=t);break;case"metronome":null!=t&&t.metronome.length>2?postMessage(["metronome",t.metronome,t.page_width,t.page_width,t.page_height]):postMessage(["metronome","empty"]);break;case"metronome-saved":console.log(e,t)}}function request(e,t,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);if(e.length)onRequestSuccess(e[0],e[1])}},r=Object.keys(r).map(e=>e+"="+r[e]).join("&"),o.open("POST",t+"?_="+(new Date).getTime(),!1),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(r)}onmessage=function(e){if(e.isTrusted)switch(e.data[0]){case"retrieve-user":retrieveUser(e.data[1],e.data[2],e.data[3]);break;case"retrieve-configuration":retrieveConfiguration(e.data[1]);break;case"retrieve-metronome":retrieveMetronome(e.data[1],e.data[2],e.data[3]);break;case"save-metronome":saveMetronome(e.data[1])}};